| 项目   | 标题 |日期 |版本 |作者 |
| ----|:-------:| :----:|----|:---:|
| 内容   |购物车设计|2018-12-20|0.1 |杜向军|

主要介绍
===============
# 一. 数据表
## 1. cart_item 购物车子表
|字段|字段名|类型（长度）|备注|
|:---:|:---:|:---:|:---:|
|id|主键|int|自增长|
|product_id|产品id|int||
|user_id|用户id|int||
|car_id|购物车id|int||
|product_type|产品类型|int|使用parm表中的字段|
|num|数量 |int(7)||
|price|单价|decimal(13,8)||
|sum|总金额|decimal(15,8)||
|time|创建时间|datetime||
|st|修改时间|datetime||
|remark|备注|varchar(100)||

## 2. cart 购物车
|字段|字段名|类型（长度）|备注|
|:---:|:---:|:---:|:---:|
|id|主键|int|自增长|
|user_id|用户id|int||
|time|创建时间|datetime||
|status|状态|int|1.初始状态 2.提交  3.删除|
|operator|操作人|int||
|st|修改时间|datetime||
|remark|备注|varchar(100)||

## 3. product_order 产品订单
|字段|字段名|类型（长度）|备注|
|:---:|:---:|:---:|:---:|
|id|主键|int|自增长|
|cart_id|购物车id|int||
|all_sum|订单金额|decimal(16,8)|
|time|创建时间|datetime||
|status|订单状态|int|1.待付款  2.取消订单  3.完成订单  4.结束订单  （和parm结合）|
|operator|操作人|int||
|st|修改时间|datetime||
|remark|备注|varchar(100)||

# 二. 功能描述：
## 1.初始化购物车  
### 触发：<br>
>> 1)如果用户操作购物车（操作购物车，查看购物车），但是本地没有初始化购物车。<br>
### 操作：<br>
>> 1)如果用户没有登陆，如果本地有购物车就直接获取本地购物车；如果本地没有购物车就创建一个购物车。<br>
>> 2)如果用户登陆：<br>
>> ①.按照接口文档3.1把参数按照规则进行传输。<br>
>> ②.发现前台没有提供购物车信息，本地没有购物车，如果后台查询到相关的数据就返回给前台，如果没有，就创建一个购物车返回。<br>
>> ③.前台提交了相关购物车信息，通过id和时间戳对比当前购物车和系统中购物车是否相同。如果相同，返回线上购物车。如果不相同就清空当前线上购物车，按照4.1对参数进行验证，如果失败，返回相应的错误信息，如果成功把提交的购物车信息存储。

## 2.修改购物车产品数量
### 触发：<br>
>> 1)当用户点击添加购物车，或者在购物车中修改产品数量。
### 操作：<br>
>> 1)使用接口3.2，按照4.2进行接口参数验证，如果成功就操作本地购物车，如果失败，就给页面返回错误信息。
## 3.删除购物车产品
### 触发：<br>
>> 1)当用户点击删除购物车中产品。
### 操作：<br>
>> 1)如果用户未登陆，直接操作本地购物车，删除该产品即可。
>> 2)如果用户登陆状态，使用接口3.3，按照4.3进行接口参数验证，如果失败就返回错误信息。成功之后就把对用的card_item表中数据的card_id滞空。
## 4.清空购物车
### 触发：<br>
>> 1)用户点击清空购物车。
### 操作：<br>
>> 1)清空本地购物车产品（并不清除本地存储的购物车id，重新生成时间戳）。
>> 2)如果用户登陆状态，访问接口3.4，按照4.4进行接口参数验证，如果失败就返回错误信息。成功之后就把card_item表中card_id对应数据滞空。
## 5.提交购物车
>> 1)用户点击提交购物车。
### 操作：<br>
>> 1)该功能必须在用户登陆下才能操作。
>> 2)使用3.5接口，并且使用4.5对接口进行验证，如果失败的话就返回错误信息，如果成功就生成订单，并且执行清空购物车操作,并且返回当前购物车id。本地清空有关购物车的所有信息。

# 三.接口文档：
## 1.获取购物车
### url:/cart/user/{userId}<br>
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|userId|用户id|int(10)|是|这个值是拼在url上的| 
### Method: POST
### data:通过json类型传输数据 ，接口只有一个名为jsonStr的参数。
#### jsonStr数据内容
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|cartId|购物车id|int(10)|否|如果用户本地存储有这个字段就提交|
|time|购物车时间戳|long(20)|否|如果用户本地存储这个字段就提交|
|products|本地购物车数据|String(300)|否|包含本地的购物车信息，如果没有就不传该参数|
##### products的数据
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|productId|产品id|int(10)|是||
|num|数量|int(7)|是||
### 验证
>> 1) 如果包含cartId就验证该购物车是否存在，不存在就返回没有购物车的错误提示。
>> 2) 购物车中不能出现两类产品，如果出现就返回提示错误信息。<br>
>> 3) 对产品的剩余量进行验证， 如果错误就返回现在的剩余量。<br>
>> 4) 按照产品的规则（最少购买份数|最多购买份数），返回错误信息提示最小购买额|最大购买额。<br>
### 返回值字段
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|type|是否成功|boolean|是||
|message|返回信息|String(300)|是|当type为false返回的是错误信息，当type为true时，返回当前的购物车|
#### message结构
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|cartId|购物车id|int|<10|否|线上的购物车id|
|time|购物车时间戳|long|<20|否|线上购物车时间戳|
|products|本地购物车数据|String(300)|否|线上购物车产品|
|allSum|购物车总金额|decimal(15,8)|否|线上购物车总金额|
#### products结构
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|productId|产品id|int(10)|是||
|productName|产品名称|String(50)|是||
|price|产品单价|decimal(13,8)|是||
|num|产品数量|int(7)|是||
|sum|总金额|decimal(15,8)|是||

## 2.修改购物车产品数量
### url:/cart/modify<br>
### Method: POST
### data:通过json类型传输数据 ，接口只有一个名为jsonStr的参数。
#### jsonStr数据内容
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|cartId|购物车id|int(10)|否|如果用户本地存储有这个字段就提交|
|productId|产品id|int(10)|是||
|num|产品数量|int(7)|是||
### 验证
>> 1) 如果包含cartId就验证该购物车是否存在，不存在就返回没有购物车的错误提示<br>
>> 2) 如果判断到用户是登陆状态，购物车中不能出现两类产品，如果出现就返回提示错误信息<br>
>> 3) 对产品的剩余量进行验证， 如果错误就返回现在的剩余量。<br>
>> 4) 按照产品的规则（最少购买份数/最多购买份数），返回错误信息提示最小购买额/最大购买额。<br>

### 返回值字段
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|type|是否成功|boolean|是||
|message|返回信息|String(300)|是|当type为false返回的是错误信息，当type为true时，返回成功提示信息|

## 3.删除购物车产品
### url:/cart/delete/{cardId}/{productId}<br>
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|cartId|购物车id|int(10)|是||
|productId|产品id|int(10)|是||
### Method: POST
### 验证
>> 1) 验证该购物车是否存在，不存在就返回没有购物车的错误提示。<br>
>> 2) 获取当前登陆用户，对用户权限进行验证，如果权限不足就返回权限不足的错误提示。<br>
### 返回值字段
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|type|是否成功|boolean|是||
|message|返回信息|String(300)|是|当type为false返回的是错误信息，当type为true时，返回成功提示信息|

## 4.清空购物车
### url:/cart/cancle/{cardId}<br>
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|cartId|购物车id|int(10)|是||
### Method: POST
### 验证
>> 1) 就验证该购物车是否存在，不存在就返回没有购物车的错误提示<br>
>> 2) 获取当前登陆用户，对用户权限进行验证。<br>
### 返回值字段
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|type|是否成功|boolean|是||
|message|返回信息|String(300)|是|当type为false返回的是错误信息，当type为true时，返回成功提示信息|

## 5.提交购物车
### url:/cart/submit/{cardId}<br>
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|cartId|购物车id|int(10)|是||
### Method: POST
### 验证
>> 1) 就验证该购物车是否存在，不存在就返回没有购物车的错误提示<br>
>> 2) 获取当前登陆用户，对用户权限进行验证。<br>
### 返回值字段
|字段|字段名|类型(长度)|是否必填|备注|
|:---:|:---:|:---:|:---:|:---:|
|type|是否成功|boolean|是||
|message|返回信息|String(300)|是|当type为false返回的是错误信息，当type为true时，返回订单id|
